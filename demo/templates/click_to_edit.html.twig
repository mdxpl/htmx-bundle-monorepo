{% extends 'base.html.twig' %}

{% block title %}Click to Edit - htmx-bundle Demo{% endblock %}

{% block body %}
<div class="mb-6">
    <h1 class="text-3xl font-bold">Click to Edit</h1>
    <p class="text-base-content/70">Click on any field to edit it inline. Changes are saved when you click "Save".</p>
    <p class="text-base-content/70 text-sm mt-2">Uses <code class="badge badge-ghost badge-sm">#[HtmxOnly]</code> attribute for edit endpoints - direct access returns 404. <a href="{{ path('app_click_to_edit_field', {field: 'name'}) }}" class="link link-primary" target="_blank">Try it</a></p>
</div>

<div class="card bg-base-100 shadow-xl max-w-lg">
    <div class="card-body">
        <h2 class="card-title">User Profile</h2>

        <div class="divide-y divide-base-300">
            <div class="py-4" id="field-name">
                {% with {field: 'name', value: profile.name} %}
                    {{ block('viewField') }}
                {% endwith %}
            </div>
            <div class="py-4" id="field-email">
                {% with {field: 'email', value: profile.email} %}
                    {{ block('viewField') }}
                {% endwith %}
            </div>
            <div class="py-4" id="field-bio">
                {% with {field: 'bio', value: profile.bio} %}
                    {{ block('viewField') }}
                {% endwith %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block viewField %}
<div class="flex justify-between items-start gap-4 cursor-pointer hover:bg-base-200 -mx-2 px-2 py-1 rounded transition-colors"
     hx-get="{{ path('app_click_to_edit_field', {field: field}) }}"
     hx-target="#field-{{ field }}"
     hx-swap="innerHTML">
    <div>
        <div class="text-sm font-semibold text-base-content/70 capitalize">{{ field }}</div>
        <div class="text-base-content">{{ value }}</div>
    </div>
    <button class="btn btn-ghost btn-xs">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
    </button>
</div>
{% endblock %}

{% block editField %}
<form hx-post="{{ path('app_click_to_edit_save', {field: field}) }}"
      hx-target="#field-{{ field }}"
      hx-swap="innerHTML"
      hx-indicator="#save-indicator-{{ field }}">
    <div class="text-sm font-semibold text-base-content/70 capitalize mb-2">{{ field }}</div>
    {% if field == 'bio' %}
    <textarea name="value"
              class="textarea textarea-bordered w-full"
              rows="3"
              autocomplete="off"
              data-1p-ignore
              data-lpignore="true"
              data-form-type="other"
              autofocus>{{ value }}</textarea>
    {% else %}
    <input type="{{ field == 'email' ? 'email' : 'text' }}"
           name="value"
           value="{{ value }}"
           class="input input-bordered w-full"
           autocomplete="off"
           data-1p-ignore
           data-lpignore="true"
           data-form-type="other"
           autofocus />
    {% endif %}
    <div class="flex gap-2 mt-2">
        <button type="submit" class="btn btn-primary btn-sm">
            <span id="save-indicator-{{ field }}" class="htmx-indicator loading loading-spinner loading-xs"></span>
            Save
        </button>
        <button type="button"
                class="btn btn-ghost btn-sm"
                hx-get="{{ path('app_click_to_edit') }}"
                hx-target="#field-{{ field }}"
                hx-select="#field-{{ field }} > *">
            Cancel
        </button>
    </div>
</form>
{% endblock %}
