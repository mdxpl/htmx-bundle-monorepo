{% extends 'base.html.twig' %}

{% block title %}Delete with Confirmation - htmx-bundle Demo{% endblock %}

{% block body %}
<div class="mb-6">
    <h1 class="text-3xl font-bold">Delete with Confirmation</h1>
    <p class="text-base-content/70">Delete items using <code class="badge badge-ghost badge-sm">hx-confirm</code>. Notifications and empty state via <code class="badge badge-ghost badge-sm">hx-swap-oob</code> - no custom JS needed.</p>
</div>

<div id="notification" class="mb-4">{{ block('notificationContent') }}</div>

<div class="card bg-base-100 shadow-xl">
    <div class="card-body">
        <div class="flex justify-between items-center mb-4">
            <h2 class="card-title">Projects</h2>
            <button class="btn btn-outline btn-sm"
                    hx-post="{{ path('app_delete_demo_reset') }}"
                    hx-target="#items-list"
                    hx-swap="innerHTML">
                Reset List
            </button>
        </div>

        <div id="items-list">
            {{ block('itemsList') }}
        </div>
    </div>
</div>

<div class="mt-6">
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">How it works</h2>
            <ul class="list-disc list-inside space-y-2">
                <li><code class="badge badge-ghost">hx-confirm</code> shows a native browser confirmation dialog</li>
                <li><code class="badge badge-ghost">hx-delete</code> sends a DELETE request</li>
                <li>Server returns empty response to remove the row via <code class="badge badge-ghost">outerHTML</code> swap</li>
                <li>Notification appears via <code class="badge badge-ghost">hx-swap-oob</code></li>
                <li>When list is empty, server updates <code class="badge badge-ghost">#items-list</code> via OOB</li>
            </ul>
        </div>
    </div>
</div>

<style>
    tr.htmx-swapping { opacity: 0; transition: opacity 0.3s ease-out; }
</style>
{% endblock %}

{% block notificationContent %}{% endblock %}

{% block notificationOob %}
<div id="notification" hx-swap-oob="true" class="mb-4">
    <div class="alert alert-success">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span>'{{ deletedName }}' has been deleted</span>
    </div>
</div>
{% endblock %}

{% block itemsList %}
{% if items|length > 0 %}
<div class="overflow-x-auto">
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr id="item-row-{{ item.id }}">
                <td>{{ item.id }}</td>
                <td>{{ item.name }}</td>
                <td>
                    <span class="badge {{ item.status == 'active' ? 'badge-success' : (item.status == 'pending' ? 'badge-warning' : 'badge-ghost') }}">
                        {{ item.status }}
                    </span>
                </td>
                <td>
                    <button class="btn btn-error btn-sm"
                            hx-delete="{{ path('app_delete_demo_item', {id: item.id}) }}"
                            hx-target="#item-row-{{ item.id }}"
                            hx-swap="outerHTML swap:300ms"
                            hx-confirm="Are you sure you want to delete '{{ item.name }}'?">
                        Delete
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
    <span>No items left. Click "Reset List" to restore.</span>
</div>
{% endif %}
{% endblock %}

{% block itemsListOob %}
<div id="items-list" hx-swap-oob="true">
    {{ block('itemsList') }}
</div>
{% endblock %}

{% block empty %}{% endblock %}

{% block sourceCode %}
{% include '_source_code.html.twig' with {controller: 'DeleteDemoController.php', template: 'delete_demo.html.twig'} %}
{% endblock %}
