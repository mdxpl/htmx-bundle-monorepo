{% extends 'base.html.twig' %}

{% block title %}Infinite Scroll Demo - htmx-bundle{% endblock %}
{% block description %}Infinite scroll demo with hx-trigger revealed - automatic content loading on scroll with URL updates and pagination.{% endblock %}

{% block body %}
<article>
    <header>
        <h1>Infinite Scroll</h1>
        <p>Scroll down to load more items automatically. No custom JavaScript code needed!</p>
        <p><small><strong>Tip:</strong> You can navigate directly to any page via URL, e.g. <a href="{{ path('app_infinite_scroll', {'page': totalPages}) }}">jump to last page</a>.</small></p>
    </header>
</article>

{% if currentPage > 1 %}
<article aria-label="Warning">
    <p><mark>You're viewing from page {{ currentPage }} of {{ totalPages }}.</mark> Earlier items are not loaded.
    <a href="{{ path('app_infinite_scroll') }}" role="button" class="outline btn-sm">Back to start</a></p>
</article>
{% endif %}

<div id="items-container" hx-indicator="#loading-indicator">
    {{ block('items') }}
</div>

<div id="loading-indicator" class="htmx-indicator" style="text-align: center; padding: 2rem;" aria-busy="true">
    Loading...
</div>

{{ block('sourceCode') }}
{% endblock %}

{% block sourceCode %}
{% include '_source_code.html.twig' with {controller: 'InfiniteScrollController.php', template: 'infinite_scroll.html.twig'} %}
{% endblock %}

{% block items %}
{% for item in items %}
<article
    {% if loop.last and hasMore %}
        hx-get="{{ path('app_infinite_scroll', {'page': nextPage}) }}"
        hx-trigger="revealed"
        hx-swap="afterend"
        hx-replace-url="true"
    {% endif %}
>
    <header><strong>{{ item.title }}</strong></header>
    <p>{{ item.description }}</p>
    <footer>
        <small>Page {{ currentPage }} of {{ totalPages }} | ID: {{ item.id }}</small>
    </footer>
</article>
{% endfor %}

{% if not hasMore %}
<article>
    <p><ins>You've reached the end!</ins> No more items to load.</p>
    {% if currentPage > 1 %}
    <footer>
        <a href="{{ path('app_infinite_scroll') }}" role="button" class="outline">Back to start</a>
    </footer>
    {% endif %}
</article>
{% endif %}
{% endblock %}
