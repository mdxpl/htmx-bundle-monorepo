{% extends 'base.html.twig' %}

{% block title %}Builder Showcase - htmx-bundle Demo{% endblock %}
{% block description %}Interactive demo of HtmxResponseBuilder methods: triggers, URL manipulation, retarget, reswap, OOB updates, and more.{% endblock %}

{% block stylesheets %}
<meta name="csrf-token" content="{{ csrf_token('htmx') }}">
<style>
    .result-box {
        padding: 0.75rem;
        background: var(--pico-card-sectionning-background-color);
        border-radius: var(--pico-border-radius);
        min-height: 50px;
        font-size: 0.875rem;
    }
    .log-entry {
        padding: 0.5rem;
        background: var(--pico-card-sectionning-background-color);
        border-radius: var(--pico-border-radius);
        margin-bottom: 0.5rem;
    }
    .log-method { font-family: monospace; color: var(--pico-primary); font-size: 0.8rem; }
    .log-desc { font-size: 0.75rem; }
</style>
{% endblock %}

{% block body %}
<article>
    <header>
        <h1>HtmxResponseBuilder Showcase</h1>
        <p>Interactive demo of all <code>HtmxResponseBuilder</code> methods. Click buttons to see each method in action.</p>
    </header>
</article>

<div class="grid">
    <div>
        <article>
            <header><strong>Trigger Events</strong></header>
            <p><small>Fire JavaScript events from server response</small></p>
            <div role="group">
                <button hx-post="{{ path('app_builder_showcase_trigger') }}" hx-swap="none">trigger()</button>
                <button hx-post="{{ path('app_builder_showcase_trigger_after_swap') }}" hx-swap="none">triggerAfterSwap()</button>
                <button hx-post="{{ path('app_builder_showcase_trigger_after_settle') }}" hx-swap="none">triggerAfterSettle()</button>
            </div>
            <div id="trigger-result" class="result-box"><small>Click button to see trigger event result</small></div>
        </article>

        <article>
            <header><strong>URL Manipulation</strong></header>
            <p><small>Change browser URL from server (watch address bar)</small></p>
            <div role="group">
                <button class="secondary" hx-post="{{ path('app_builder_showcase_push_url') }}" hx-swap="none">pushUrl()</button>
                <button class="secondary" hx-post="{{ path('app_builder_showcase_replace_url') }}" hx-swap="none">replaceUrl()</button>
                <button class="secondary" hx-post="{{ path('app_builder_showcase_location') }}" hx-swap="none">location()</button>
            </div>
        </article>

        <article>
            <header><strong>Retarget & Reselect</strong></header>
            <p><small>Server controls where content goes</small></p>
            <div role="group">
                <button class="contrast" hx-post="{{ path('app_builder_showcase_retarget') }}" hx-target="#original-target" hx-swap="innerHTML">retarget()</button>
                <button class="contrast" hx-post="{{ path('app_builder_showcase_reselect') }}" hx-target="#reselect-area" hx-swap="innerHTML">reselect()</button>
            </div>
            <div class="grid" style="margin-top: 0.5rem;">
                <div id="original-target" class="result-box"><small>Original target</small></div>
                <div id="retarget-area" class="result-box"><small>Retarget area</small></div>
                <div id="reselect-area" class="result-box"><small>Reselect area</small></div>
            </div>
        </article>

        <article>
            <header><strong>Reswap & Modifiers</strong></header>
            <p><small>Control how content is swapped</small></p>
            <div role="group">
                <button class="outline" hx-post="{{ path('app_builder_showcase_reswap_append') }}" hx-target="#items-list" hx-swap="innerHTML">Append</button>
                <button class="outline" hx-post="{{ path('app_builder_showcase_reswap_transition') }}" hx-swap="none">+Transition</button>
                <button class="outline" hx-post="{{ path('app_builder_showcase_reswap_timing') }}" hx-swap="none">+Timing(1s)</button>
            </div>
            <div class="grid" style="margin-top: 0.5rem;">
                <div id="items-list" class="result-box"></div>
                <div id="transition-area" class="result-box"><small>Transition</small></div>
                <div id="timing-area" class="result-box"><small>Timing</small></div>
            </div>
        </article>

        <article>
            <header><strong>Success & Failure Status</strong></header>
            <p><small>HTTP status codes: 200 vs 422</small></p>
            <div role="group">
                <button hx-post="{{ path('app_builder_showcase_success') }}" hx-target="#status-result" hx-swap="innerHTML">success() → 200</button>
                <button class="secondary" hx-post="{{ path('app_builder_showcase_failure') }}" hx-target="#status-result" hx-swap="innerHTML">failure() → 422</button>
            </div>
            <div id="status-result" class="result-box"><small>Click to see HTTP status difference</small></div>
        </article>

        <article>
            <header><strong>Multiple OOB & No Content</strong></header>
            <p><small>Advanced response patterns</small></p>
            <div role="group">
                <button class="outline" hx-post="{{ path('app_builder_showcase_multiple_oob') }}" hx-swap="none">Multiple viewBlock()</button>
                <button class="outline" hx-post="{{ path('app_builder_showcase_no_content') }}" hx-swap="none">noContent() + trigger</button>
            </div>
            <div class="grid" style="margin-top: 0.5rem;">
                <div id="oob-area-1" class="result-box">Area 1</div>
                <div id="oob-area-2" class="result-box">Area 2</div>
                <div id="oob-area-3" class="result-box">Area 3</div>
                <div id="no-content-result" class="result-box"><small>204 result</small></div>
            </div>
        </article>
    </div>

    <div>
        <article style="position: sticky; top: 1rem;">
            <header>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <strong>Activity Log</strong>
                    <button class="outline btn-sm" hx-post="{{ path('app_builder_showcase_clear_log') }}" hx-swap="none">Clear</button>
                </div>
            </header>
            <div id="log-list" style="max-height: 400px; overflow-y: auto;">
                <p><small>Click buttons to see methods in action</small></p>
            </div>
        </article>
    </div>
</div>

{{ block('sourceCode') }}
{% endblock %}

{% block sourceCode %}
{% include '_source_code.html.twig' with {controller: 'BuilderShowcaseController.php', template: 'builder_showcase.html.twig'} %}
{% endblock %}

{% block logEntryOob %}
<div id="log-list" hx-swap-oob="afterbegin">
    <div class="log-entry">
        <div class="log-method">{{ log.method }}</div>
        <div class="log-desc">{{ log.description }}</div>
    </div>
</div>
{% endblock %}

{% block logListOob %}
<div id="log-list" hx-swap-oob="true" style="max-height: 400px; overflow-y: auto;">
    {% if logs|length > 0 %}
        {% for log in logs %}
        <div class="log-entry">
            <div class="log-method">{{ log.method }}</div>
            <div class="log-desc">{{ log.description }}</div>
        </div>
        {% endfor %}
    {% else %}
        <p><small>Log cleared</small></p>
    {% endif %}
</div>
{% endblock %}

{% block retargetContent %}
<div style="color: var(--pico-ins-color); font-weight: bold;">✓ Content arrived here via retarget()!</div>
{% endblock %}

{% block newItem %}
<kbd style="margin-right: 0.25rem;">Item #{{ itemId }}</kbd>
{% endblock %}

{% block transitionContent %}
<div style="color: var(--pico-mark-background-color); font-weight: bold;">✨ Transitioned! ({{ "now"|date("H:i:s") }})</div>
{% endblock %}

{% block timingContent %}
<div style="color: var(--pico-del-color); font-weight: bold;">⏱️ Delayed 1s! ({{ "now"|date("H:i:s") }})</div>
{% endblock %}

{% block reselectFullResponse %}
<div id="ignored-part" style="color: var(--pico-del-color);">This part is ignored</div>
<div id="selected-part" style="color: var(--pico-ins-color); font-weight: bold;">✓ Only this part was selected!</div>
<div id="also-ignored" style="color: var(--pico-del-color);">This is also ignored</div>
{% endblock %}

{% block oobArea1 %}
<div id="oob-area-1" hx-swap-oob="true" class="result-box" style="background: rgba(54, 211, 153, 0.2);">Updated 1! ✓</div>
{% endblock %}

{% block oobArea2 %}
<div id="oob-area-2" hx-swap-oob="true" class="result-box" style="background: rgba(251, 189, 35, 0.2);">Updated 2! ✓</div>
{% endblock %}

{% block oobArea3 %}
<div id="oob-area-3" hx-swap-oob="true" class="result-box" style="background: rgba(102, 26, 230, 0.2);">Updated 3! ✓</div>
{% endblock %}

{% block successResult %}
<div style="background: var(--pico-ins-color); color: #fff; padding: 1rem; border-radius: var(--pico-border-radius);">
    <strong>HTTP 200 OK</strong><br>
    <small>success() - standard successful response</small>
</div>
{% endblock %}

{% block failureResult %}
<div style="background: var(--pico-del-color); color: #fff; padding: 1rem; border-radius: var(--pico-border-radius);">
    <strong>HTTP 422 Unprocessable Entity</strong><br>
    <small>failure() - validation errors (htmx still swaps)</small>
</div>
{% endblock %}

{% block triggerResultOob %}
<div id="trigger-result" hx-swap-oob="true" class="result-box" style="background: rgba(54, 211, 153, 0.2);">
    <strong style="color: var(--pico-ins-color);">{{ triggerType }}:</strong> {{ message }} <small>({{ "now"|date("H:i:s") }})</small>
</div>
{% endblock %}

{% block javascripts %}
<script>
document.body.addEventListener('noContentDemo', function(evt) {
    const el = document.getElementById('no-content-result');
    el.style.background = 'rgba(251, 189, 35, 0.2)';
    el.innerHTML = '<strong>204 + trigger ✓</strong>';

    const log = document.getElementById('log-list');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.innerHTML = '<div class="log-method">noContent()</div><div class="log-desc">HTTP 204 sent (no body), but trigger header reached JS!</div>';
    log.insertBefore(entry, log.firstChild);
});
</script>
{% endblock %}
