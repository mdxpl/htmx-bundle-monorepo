{% extends 'base.html.twig' %}

{% block title %}Cascading Selects - htmx-bundle Demo{% endblock %}

{% block body %}
<div class="mb-6">
    <h1 class="text-3xl font-bold">Cascading Selects</h1>
    <p class="text-base-content/70">Select a country to load its cities dynamically.</p>
    <p class="text-base-content/70 text-sm mt-2">Uses <code class="badge badge-ghost badge-sm">hx-get</code> with <code class="badge badge-ghost badge-sm">hx-trigger="change"</code> to load dependent options.</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">Select Location</h2>

            <form hx-post="{{ path('app_cascading_submit') }}"
                  hx-target="#result"
                  hx-indicator="#submit-spinner">

                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text">Country</span>
                    </label>
                    <select name="country"
                            class="select select-bordered w-full"
                            hx-get="{{ path('app_cascading_cities', {country: '__COUNTRY__'}) }}"
                            hx-trigger="change"
                            hx-target="#city-select"
                            hx-swap="outerHTML"
                            hx-indicator="#city-spinner"
                            hx-on::config-request="event.detail.path = event.detail.path.replace('__COUNTRY__', this.value)">
                        <option value="" disabled selected>Select a country...</option>
                        {% for code, name in countries %}
                        <option value="{{ code }}">{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text">City</span>
                        <span id="city-spinner" class="htmx-indicator loading loading-spinner loading-xs"></span>
                    </label>
                    <select name="city"
                            id="city-select"
                            class="select select-bordered w-full"
                            disabled>
                        <option value="" disabled selected>Select a country first...</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary w-full">
                    <span id="submit-spinner" class="htmx-indicator loading loading-spinner loading-sm"></span>
                    Submit
                </button>
            </form>
        </div>
    </div>

    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">Result</h2>
            <div id="result">
                <p class="text-base-content/50">Select a country and city, then submit.</p>
            </div>
        </div>
    </div>
</div>

<div class="mt-6">
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">How it works</h2>
            <ul class="list-disc list-inside space-y-2">
                <li>Country select has <code class="badge badge-ghost">hx-trigger="change"</code></li>
                <li>When country changes, htmx fetches cities for that country</li>
                <li>City select gets replaced with new options</li>
                <li>Form submission also uses htmx for seamless experience</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block cityOptions %}
<select name="city"
        id="city-select"
        class="select select-bordered w-full">
    {% if cities|length > 0 %}
    <option value="" disabled selected>Select a city...</option>
    {% for code, name in cities %}
    <option value="{{ code }}">{{ name }}</option>
    {% endfor %}
    {% else %}
    <option value="" disabled selected>No cities available</option>
    {% endif %}
</select>
{% endblock %}

{% block result %}
<div class="alert alert-success">
    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
    <div>
        <div class="font-bold">Location Selected</div>
        <div>{{ city }}, {{ country }}</div>
    </div>
</div>
{% endblock %}

{% block sourceCode %}
{% include '_source_code.html.twig' with {controller: 'CascadingController.php', template: 'cascading.html.twig'} %}
{% endblock %}
